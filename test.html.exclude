<!DOCTYPE html>
<html>
<head>
    <title>index</title>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script>
        var q;
        var obj;
        var response;
        var next;

        $.ajax({
            url: 'questions.json',
            dataType: 'json',
            cache: false,
            success: function (data) {
                q = data;
                console.log(q);
                writeQuestion(1);
            }
        });

        function getObjects(obj, key, val) {
            var objects = [];
            for (var i in obj) {
                if (!obj.hasOwnProperty(i)) continue;
                if (typeof obj[i] == 'object') {
                    objects = objects.concat(getObjects(obj[i], key, val));
                } else if (i == key && obj[key] == val) {
                    objects.push(obj);
                }
            }
            return objects;
        }


        function writeQuestion(n) {
            console.log(n);
            obj = getObjects(q, 'number', n)[0];
            response = obj.r;
            console.log(response);

            $('<div class="question">' + obj.intro + '</div>').appendTo('body');
            


            if (obj.type === 'mc') {
                for (var i in obj.possible_answers) {
                    answer = obj.possible_answers[i];
                    next = obj.next[answer];

                    console.log(answer);
                    console.log(next);
                    
                    $('<div class="checkbox" data-next="' + next + '">' + obj.possible_answers[i] + '</div>').appendTo('body');
                }
                console.log(obj.possible_answers);
            } else if (obj.type === 'open') {
                writeResponse();

                next = obj.next;
                writeQuestion(next);
            }
        }

        function writeResponse() {
            $('<div class="response">' + response + '</div><hr />').appendTo('body');
        }

        $(document).one('click', '.checkbox', function () {
            writeResponse();
            next = $(this).data('next');
            writeQuestion(next);
        });
    </script>
</body>
</html>